<div>
  <h2>AI Application Assistant</h2>
  <p>Select the skills and experiences relevant to the job, paste the job description, and let the AI craft your application letters.</p>
  <hr />

  <!-- =================== Selection Sections =================== -->
  <h3>1. Select Your Relevant Information</h3>

  <div class="row">
    <!-- Work Experience Column -->
    <div class="col-md-6">
      <h5>Work Experience (CV)</h5>
      <div class="mb-2">
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="toggleSelectAll('cv', true)">Select All</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="toggleSelectAll('cv', false)">Deselect All</button>
      </div>
      <ul class="list-group selection-list">
        <li *ngFor="let cv of allMyCvEntries" class="list-group-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'cv-' + cv.id"
              [checked]="isSelected(cv, 'cv')"
              (change)="onSelectionChange(cv, $event, 'cv')"
            />
            <label class="form-check-label" [for]="'cv-' + cv.id">
              {{ cv.companyName }}
            </label>
          </div>
        </li>
      </ul>
    </div>

    <!-- Projects Column -->
    <div class="col-md-6">
      <h5>Projects</h5>
      <div class="mb-2">
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="toggleSelectAll('project', true)">Select All</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="toggleSelectAll('project', false)">Deselect All</button>
      </div>
      <ul class="list-group selection-list">
        <li *ngFor="let project of allMyProjects" class="list-group-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'project-' + project.id"
              [checked]="isSelected(project, 'project')"
              (change)="onSelectionChange(project, $event, 'project')"
            />
            <label class="form-check-label" [for]="'project-' + project.id">
              {{ project.title }}
            </label>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div class="row mt-4">
    <!-- Skills Column -->
    <div class="col-md-6">
      <h5>Skills</h5>
      <div class="mb-2">
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="toggleSelectAll('skill', true)">Select All</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="toggleSelectAll('skill', false)">Deselect All</button>
      </div>
      <ul class="list-group selection-list">
        <li *ngFor="let skill of allMySkills" class="list-group-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'skill-' + skill.id"
              [checked]="isSelected(skill, 'skill')"
              (change)="onSelectionChange(skill, $event, 'skill')"
            />
            <label class="form-check-label" [for]="'skill-' + skill.id">
              {{ skill.name }}
            </label>
          </div>
        </li>
      </ul>
    </div>

    <!-- About Me Column -->
    <div class="col-md-6">
      <h5>About Me Sections</h5>
      <div class="mb-2">
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="toggleSelectAll('aboutMe', true)">Select All</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="toggleSelectAll('aboutMe', false)">Deselect All</button>
      </div>
      <ul class="list-group selection-list">
        <li *ngFor="let about of allAboutMe" class="list-group-item">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="'about-' + about.id"
              [checked]="isSelected(about, 'aboutMe')"
              (change)="onSelectionChange(about, $event, 'aboutMe')"
            />
            <label class="form-check-label" [for]="'about-' + about.id">
              About Me Section (ID: {{ about.id }})
            </label>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <hr class="my-4" />

  <!-- =================== Job Post and Model Selection =================== -->
  <h3>2. Paste the Job Description</h3>
  <textarea [(ngModel)]="jobPost" rows="10" class="form-control mb-3" placeholder="Paste the full job description here..."></textarea>

  <h3>3. Select AI Model</h3>
  <select [(ngModel)]="selectedModel" class="form-select mb-3" [disabled]="availableModels.length === 0">
    <option *ngIf="availableModels.length === 0" value="">Loading models...</option>
    <option *ngFor="let model of availableModels" [value]="model">
      {{ model }}
    </option>
  </select>

  <button
    (click)="generateAnalysis()"
    [disabled]="isLoading || !jobPost || !selectedModel"
    class="btn btn-primary">
    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    {{ isLoading ? ' Analyzing...' : 'Analyze and Generate Letters' }}
  </button>

  <!-- =================== Results Section =================== -->
  <div *ngIf="analysisResult" class="mt-4">
    <hr />
    <h3>Analysis Results</h3>

    <h4>Fit Score: {{ analysisResult.fitAnalysis.scorePercentage }}%</h4>
    <p><strong>Reasoning:</strong> {{ analysisResult.fitAnalysis.reasoning }}</p>

    <div>
      <strong>Matching Skills:</strong>
      <ul>
        <li *ngFor="let skill of analysisResult.fitAnalysis.matchingSkills">{{ skill }}</li>
      </ul>
    </div>
    <div>
      <strong>Potential Gaps:</strong>
      <ul>
        <li *ngFor="let skill of analysisResult.fitAnalysis?.missingSkills">{{ skill }}</li>
      </ul>
    </div>

    <h3>Generated Cover Letter</h3>
    <pre>{{ analysisResult.coverLetter }}</pre>
    <h3>Generated Application Letter</h3>
    <pre>{{ analysisResult.applicationLetter }}</pre>
    <h3>Generated Motivation Letter</h3>
    <pre>{{ analysisResult.motivationLetter }}</pre>
  </div>
</div>
